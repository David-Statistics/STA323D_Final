---
title: "Sta 323 - Final - Spring 2016"
output: rmarkdown::html_document
runtime: shiny
---
<style type="text/css">
.table {
    width: 40%;
    position: relative;
    left: 7.5%;
}
</style>

<br/><br/>

### Rules

1. Your solutions must be written up using this R Markdown (Rmd) file, this file must include your code and write up for each task.

2. This exam is open book, open internet, closed other people. You may use *any* online or book based resource you would like, but you must include citations for any code that you use (directly or indirectly). You *may not* consult with anyone else about this exam other than the Professor or TAs for this course - this includes posting anything online.

3. You have until 11 pm on Thursday, April 7th to complete this exam and turn it in via the Sakai assignments tool - late work will not be accepted. You should only submit this Rmd file and nothing else. Resubmissions are allowed, but only your last submission (before the deadline) will be graded. Technical difficulties are not an excuse for late work - do not wait until the last minute to upload.

4. All of your answers must include a brief description / writeup of your approach. This includes both annotating / commenting your code *and* a separate written descriptions of all code / implementations. I should be able to suppress *all* code output in your document and still be able to read and make sense of your answers.


5. The most important goal is to write code that can accomplish the given tasks, note however that grading will at least be partially based on the quality of the code you write - elegant, efficient code will be rewarded and messy, slow code will be penalized.

6. No extensions will be given for this exam, any late exams will not be considered. 

<br/>

### The other normalization

For this exam you will be working with data from an imaginary company, specifically a number of tables representing basic information about the company's employees. The company's data based administrator was a little bit overzealous in their normalization of the records and as such it is painful to answer even simple questions about the current employees.

#### Data

There are currently 8 separate tables covering the various employee details, a brief description of each table follows. These data are available as `employee.Rdata` on Sakai.


* `employees` - Table listing all current employees 

| Column     | Description                  |
|:-----------|:-----------------------------|
| `emp_id`   | Employee's unique id number  |
| `name`     | Employee's full name         |
| `gender`   | Employee's gender            |


* `departments` - Table listing all departments within the company

| Column     | Description                  |
|:-----------|:-----------------------------|
| `dept_id`  | Department's unique id       |
| `dept_name`| Department's name            |


* `pay_periods` - Table listing all possible pay periods for employees

| Column      | Description                  |
|:------------|:-----------------------------|
| `pay_id`    | Pay period's unique id       |
| `pay_period`| Pay period name              |


* `education` - Table listing all possible education levels

| Column     | Description                  |
|:-----------|:-----------------------------|
| `ed_id`    | Degree's unique id           |
| `degree`   | Type of degree               |


* `employee_departments` - Table mapping employees to their departments (one-to-many)

| Column     | Description                  |
|:-----------|:-----------------------------|
| `emp_id`   | Employee's unique id         |
| `dept_id`  | Department's unique id       |


* `employee_pay_periods` - Table mapping employees to their pay periods (one-to-many)

| Column     | Description                  |
|:-----------|:-----------------------------|
| `emp_id`   | Employee's unique id         |
| `pay_id`   | Pay period's unique id       |


* `employee_salaries` - Table mapping employees to their salary (per pay period) (one-to-many)

| Column     | Description                  |
|:-----------|:-----------------------------|
| `emp_id`   | Employee's unique id         |
| `salary`   | Salary per pay period        |


* `employee_education` - Table mapping employees to their completed degrees (many-to-many)

| Column     | Description                  |
|:-----------|:-----------------------------|
| `emp_id`   | Employee's unique id         |
| `ed_id`    | Degree's unique id           |


### Task 1 (20 pts)

Combine these 8 tables into a single tidy data frame called `emp_full`. There should be one row per employee (5000 total) and should include all the available information about that employee. The final data frame *should not* include any of the id columns except for `emp_id`. 

You should be able to accomplish this task without using any for loops - you are free to use dplyr or base R or any combination there of. As usual, the more elegant your solution the better your grade will be.


```{r}
suppressMessages(library(dplyr))
library(magrittr)
library(plyr)
library(reshape2)
load(file="employee.Rdata")

emp_full = full_join(employees,employee_departments,by = "emp_id") %>%
  full_join(.,employee_pay_periods,by = "emp_id") %>%
  full_join(.,employee_salaries,by = "emp_id") %>%
  full_join(.,employee_education,by = "emp_id")

df = as.data.frame(sapply(1:6,function(x) sapply(employee_education$ed_id, function(y) as.integer(x == y)))) %>% names(df) = c(education$degree)
emp_full = bind_cols(emp_full,df) %>%



```

### Task 2 (30 pts)

For the following subtasks you may use either the original tables or the new `emp_full` table.

1. (6 pts) Visualize the number of each type of degree by company department. (Note - if an employee has more than one degree you should count only the highest degree achieved)

```{r}

```

2. (6 pts) For each department calculate the minimum, maximum, mean, median, Q1, Q3 of salary as well as the department's overall payroll obligation (Note - you need to pay attention to pay period to assess this properly)

```{r}

```

3. (6 pts) Is there a salary disparity between the male and female employees at this company? What about within the individual departments? 

```{r}

```

4. (6 pts) Summarize the break down of BS vs BA degrees for each department. (Note - for these data anyone with a post-secondary degree will also have a Bachelors of some kind)

```{r}

```

5. (6 pts) Construct a matrix that contains the counts of the co-occurrence of the first letter of the employees' first and last names. This matrix should have 26 rows and 26 columns - the rows representing the first letter of the first name and the columns representing the first letter of the last name. For example, Andre Alexander would add a count to the cell at row 1 column 1. Use this matrix to create a visualization that you can use to comment on whether alliterative names (first letter of first and last names are the same, e.g. Andre Alexander) are more or less common than expected.

```{r}

```

